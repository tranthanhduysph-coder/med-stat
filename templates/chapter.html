{% extends "base.html" %}
{% block content %}
<div class="container mx-auto px-4 py-12 max-w-4xl">
    
    <!-- Header Section -->
    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg mb-8">
        <!-- Dữ liệu này được lấy từ COURSE_MODULES trong app.py -->
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">{{ chapter_data.title }}</h1>
        
        {% if download_url %}
        <a href="{{ download_url }}" download 
           class="inline-flex items-center bg-green-600 text-white font-bold py-2 px-5 rounded-lg shadow-md hover:bg-green-700 transition duration-300 mb-6">
            <!-- Icon Download SVG -->
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
            Tải tài liệu (PDF)
        </a>
        {% endif %}
    </div>

    <!-- Video Player -->
    <div class="aspect-w-16 aspect-h-9 mb-8 bg-gray-200 rounded-lg shadow-lg overflow-hidden">
        <iframe src="{{ chapter_data.video_url }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full"></iframe>
    </div>
    
    <!-- === NỘI DUNG CHI TIẾT ĐƯỢC NẠP VÀO ĐÂY === -->
    <!-- 
      Dòng code Jinja2 này sẽ tự động tìm và chèn nội dung 
      từ thư mục /templates/content/ (ví dụ: file 'chapter_10_11.html' bạn đã cung cấp)
    -->
    <div class="bg-white p-6 md:p-10 rounded-lg shadow-lg mb-12 prose prose-lg max-w-none prose-blue">
        {% include content_template_path %}
    </div>
    
    <!-- Quiz Button -->
    <div class="text-center">
        <button id="start-quiz-btn" data-chapter-id="{{ chapter_data.id }}" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-blue-700 transition duration-300 text-lg transform hover:scale-105">
            Bắt đầu Tự lượng giá
        </button>
    </div>
</div>

<!-- === MODAL DÀNH CHO QUIZ === -->
<!-- Cửa sổ này bị ẩn (hidden) và sẽ được 'main.js' kích hoạt -->
<div id="quiz-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
        
        <!-- Modal Header -->
        <div class="flex justify-between items-center p-5 border-b">
            <h3 class="text-2xl font-semibold text-gray-800" id="quiz-title">Bài lượng giá: {{ chapter_data.title }}</h3>
            <button id="close-quiz-btn" class="text-gray-400 hover:text-gray-600 text-3xl font-bold">&times;</button>
        </div>
        
        <!-- Modal Body (Nơi chứa Quiz) -->
        <div id="quiz-body" class="p-6 overflow-y-auto space-y-6">
            
            <!-- Trạng thái Đang tải -->
            <div id="quiz-loading" class="text-center py-10 flex flex-col items-center">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4" style="border-top-color: #3498db; animation: spinner 1.5s linear infinite;"></div>
                <p class="text-lg text-gray-600">AI đang tạo 20 câu hỏi, vui lòng chờ...</p>
            </div>
            
            <!-- Form Quiz (bị ẩn ban đầu) -->
            <form id="quiz-form" class="hidden space-y-5"></form>

            <!-- Kết quả Quiz (bị ẩn ban đầu) -->
            <div id="quiz-results" class="hidden">
                <h4 class="text-2xl font-bold text-center mb-4" id="quiz-score"></h4>
                <p class="text-center text-lg text-gray-700 mb-6" id="quiz-summary"></p>
                <div id="quiz-review" class="space-y-4 max-h-64 overflow-y-auto pr-2">
                    <!-- Các câu trả lời sai sẽ được chèn vào đây bởi JS -->
                </div>
            </div>
        </div>
        
        <!-- Modal Footer -->
        <div class="p-5 border-t flex justify-end space-x-4">
            <button id="submit-quiz-btn" type="button" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300 hidden">Nộp bài</button>
            <button id="retake-quiz-btn" type="button" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition duration-300 hidden">Làm lại</button>
        </div>
    </div>
</div>
{% endblock %}

