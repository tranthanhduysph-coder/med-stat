<!DOCTYPE html>
<html lang="vi" class="h-full bg-gray-100">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}NCKH & Thống kê Y học{% endblock %} - ThS. Trần Thanh Duy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .nav-link { @apply px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200 hover:text-gray-900; }
        .nav-link.active { @apply bg-blue-100 text-blue-700; }
        .prose { @apply max-w-none text-gray-700; }
        .prose h2 { @apply text-2xl font-semibold text-gray-800 mb-4 mt-6 border-b pb-2; }
        .prose h3 { @apply text-xl font-semibold text-gray-700 mb-3 mt-5; }
        .prose p { @apply mb-4 leading-relaxed; }
        .prose ul { @apply list-disc list-outside pl-6 mb-4 space-y-2; }
        .prose ol { @apply list-decimal list-outside pl-6 mb-4 space-y-2; }
        .prose li { @apply mb-2; }
        .prose a { @apply text-blue-600 hover:underline; }
        .prose table { @apply w-full my-6 border-collapse border border-gray-300; }
        .prose th { @apply bg-gray-100 border border-gray-300 px-4 py-2 text-left font-semibold; }
        .prose td { @apply border border-gray-300 px-4 py-2; }
        .prose strong { @apply font-semibold; }
        .prose code { @apply bg-gray-200 text-sm font-mono px-1 py-0.5 rounded; }
        
        #loading-spinner {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6;
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; z-index: 1000;
            display: none;
        }
        @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

        .ai-response { font-size: 1rem; line-height: 1.6; }
        .ai-response h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.25rem; }
        .ai-response ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .ai-response li { margin-bottom: 0.25rem; }
        .ai-response p { margin-bottom: 1rem; }
        .ai-response code { background-color: #f3f4f6; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-family: monospace; }
        .ai-response pre { background-color: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 1rem; }
        .ai-response strong { font-weight: 600; }
        .ai-response blockquote { border-left: 4px solid #d1d5db; padding-left: 1rem; margin-left: 0; font-style: italic; color: #4b5563; }
        .ai-response .citation { font-size: 0.875rem; color: #6b7280; margin-top: 1rem; border-top: 1px dashed #e5e7eb; padding-top: 0.5rem; }
        .ai-response .citation a { color: #3b82f6; text-decoration: none; }
        .ai-response .citation a:hover { text-decoration: underline; }
        .hidden { display: none; }
        .loader {
            border-top-color: #3498db;
            animation: spinner 1.5s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body class="h-full flex flex-col">
    <div id="loading-spinner"></div>

    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="/" class="flex items-center space-x-2 flex-shrink-0">
                    <i class='bx bxs-brain text-3xl text-blue-600'></i>
                    <span class="text-xl font-bold text-gray-800 hidden sm:block">NCKH Y học (AI)</span>
                </a>
                
                <div class="flex items-center space-x-2 md:space-x-4">
                    {% set active_page = request.endpoint %}
                    <a href="/" class="nav-link {% if active_page == 'home' %}active{% endif %}">
                        <i class='bx bxs-book-open sm:mr-2'></i> <span class="hidden sm:inline">Module Học tập</span>
                    </a>
                    <a href="/proposal-builder" class="nav-link {% if active_page == 'proposal_builder' %}active{% endif %}">
                        <i class='bx bxs-edit-alt sm:mr-2'></i> <span class="hidden sm:inline">Tạo Đề cương</span>
                    </a>
                    <a href="/ai-tools" class="nav-link {% if active_page == 'ai_tools' %}active{% endif %}">
                        <i class='bx bxs-wrench sm:mr-2'></i> <span class="hidden sm:inline">Công cụ AI</span>
                    </a>
                    <a href="/ai-assistant" class="nav-link {% if active_page == 'ai_assistant' %}active{% endif %}">
                        <i class='bx bxs-conversation sm:mr-2'></i> <span class="hidden sm:inline">Trợ lý AI</span>
                    </a>
                    <a href="/ethics" class="nav-link {% if active_page == 'ethics' %}active{% endif %}">
                        <i class='bx bxs-shield-check sm:mr-2'></i> <span class="hidden sm:inline">Đạo đức NCKH</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-white mt-12 border-t border-gray-200">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500">
            <p class="text-sm">
                Phát triển bởi <span class="font-medium text-gray-700">ThS. Trần Thanh Duy</span> | Email: <a href="mailto:ttduy@sgu.edu.vn" class="text-blue-600 hover:underline">ttduy@sgu.edu.vn</a>
            </p>
            <p class="text-sm mt-1">
                Trang web này sử dụng AI tạo sinh. <button id="open-disclaimer-btn" class="text-blue-600 hover:underline font-medium">Xem Cảnh báo & Miễn trừ trách nhiệm</button>
            </p>
        </div>
    </footer>

    <div id="disclaimer-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6 md:p-8 relative">
            <button id="close-disclaimer-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class='bx bx-x text-2xl'></i>
            </button>
            <div class="flex items-center space-x-3 mb-4">
                <i class='bx bxs-error-triangle text-3xl text-yellow-500'></i>
                <h3 class="text-xl font-bold text-gray-800">Cảnh báo & Miễn trừ trách nhiệm</h3>
            </div>
            <div class="text-sm text-gray-700 space-y-3">
                <p>Nền tảng này sử dụng mô hình ngôn ngữ lớn (AI) để cung cấp các gợi ý và phản hồi. Các thông tin do AI tạo ra chỉ mang tính chất tham khảo, hỗ trợ học tập và không thể thay thế cho kiến thức chuyên môn, sự phán đoán của giảng viên hoặc các hướng dẫn học thuật chính thức.</p>
                <p>Người biên soạn (<span class="font-medium">Trần Thanh Duy</span>) không chịu trách nhiệm về bất kỳ sự sai lệch, thiếu sót, hoặc hậu quả nào phát sinh từ việc sử dụng các thông tin do AI cung cấp.</p>
                <p class="font-medium">Người dùng có trách nhiệm tự kiểm tra, đối chiếu và chịu trách nhiệm cuối cùng cho sản phẩm học thuật (đề cương, bài báo...) của mình. Luôn luôn tham khảo ý kiến của giảng viên hướng dẫn.</p>
            </div>
        </div>
    </div>
    
    <div id="quiz-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            
            <div class="flex justify-between items-center p-5 border-b">
                <h3 id="quiz-title" class="text-2xl font-semibold text-gray-800">Bài lượng giá</h3>
                <button id="close-quiz-btn" class="text-gray-400 hover:text-gray-600 text-3xl font-bold">&times;</button>
            </div>
            
            <div id="quiz-body" class="p-6 overflow-y-auto space-y-6">
                
                <div id="quiz-loading" class="text-center py-10 flex flex-col items-center">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                    <p class="text-lg text-gray-600">AI đang tạo 20 câu hỏi, vui lòng chờ...</p>
                </div>
                
                <form id="quiz-form" class="hidden space-y-5"></form>

                <div id="quiz-results" class="hidden">
                    <h4 class="text-2xl font-bold text-center mb-4" id="quiz-score"></h4>
                    <p class="text-center text-lg text-gray-700 mb-6" id="quiz-summary"></p>
                    <div id="quiz-review" class="space-y-4 max-h-64 overflow-y-auto pr-2">
                    </div>
                </div>
            </div>
            
            <div class="p-5 border-t flex justify-end space-x-4">
                <button id="submit-quiz-btn" type="button" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300 hidden">Nộp bài</button>
                <button id="retake-quiz-btn" type="button" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition duration-300 hidden">Làm lại</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

